# BatmanInfer

### 项目目标

* 设备: Mobile GPU、CPU

### 1.1 一期目标 

* 实现LSTM模型编译 (2024-10-31截止)
* 实现GPT-2模型编译
* 实现Int8量化

> **技术难点**
>
> KVCaches增加
>
> `ONNX`模型转译`Operator`
>
> `OpenCL`和`GPU` 中的算子加速

**已知问题**

1. 编译`onnx`到系统需要先进行```protoc -I=. --cpp_out=. onnx.proto```
2. 关注`CMakeLists`几个库的设置

### 1.2 OpenMP的`API`接口

#### `#pragma omp parallel for`

> 循环的每次迭代可以由一个独立的线程执行

`#pragma omp critical`

> 临界区是指一段必须由一个线程独占执行的代码，以防止数据竞争

`pragma omp simd`

> 用于将 SIMD（单指令多数据）向量化应用于后续的循环

### 1.3 算子模块

#### 1. `Conv`算子 - 非padding

<img src="./images/image-20241105161738102.png" alt="image-20241105161738102" style="zoom:50%;" />

> 1. **input_size**：
>    - 输入特征图的尺寸（可以是高度或宽度）。
> 2. **pooling_size**：
>    - 池化窗口的尺寸（可以是高度或宽度）。池化窗口是在输入特征图上滑动的一个小区域，用于计算最大值或平均值。
> 3. **stride**：
>    - 步长，指池化窗口在输入特征图上滑动时每次移动的距离。步长越大，输出特征图的尺寸越小，因为窗口覆盖的区域会更少。
> 4. **floor**：
>    - 表示向下取整操作。由于池化窗口可能无法整齐地覆盖输入特征图的所有位置，向下取整确保输出尺寸为整数。

#### 2. `Conv`算子 - 带padding

<img src="./images/image-20241105162502567.png" alt="image-20241105162502567" style="zoom:50%;" />

> 1. **input_size**：
>    - 输入特征图的尺寸（可以是高度或宽度）。
> 2. **padding**：
>    - 填充的大小，指在输入特征图的边缘添加的像素数。填充通常用于防止池化窗口在边缘处无法完全覆盖输入特征图。
> 3. **pooling_size**：
>    - 池化窗口的尺寸（可以是高度或宽度）。池化窗口在输入特征图上滑动，用于计算最大值或平均值。
> 4. **stride**：
>    - 步长，指池化窗口在输入特征图上滑动时每次移动的距离。步长越大，输出特征图的尺寸越小。
> 5. **floor**：
>    - 表示向下取整操作。因为池化窗口可能无法整齐地覆盖输入特征图的所有位置，向下取整确保输出尺寸为整数。

